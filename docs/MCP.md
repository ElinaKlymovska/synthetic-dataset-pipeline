# üìä MCP - –°–∏—Å—Ç–µ–º–∞ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ú–µ—Ç–∞–¥–∞–Ω–∏–º–∏

## –©–æ —Ç–∞–∫–µ MCP?

**MCP (Metadata Collection Protocol)** - —Ü–µ —Å–∏—Å—Ç–µ–º–∞ –∑–±–æ—Ä—É —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏ –¥–ª—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö –∑–æ–±—Ä–∞–∂–µ–Ω—å —É –ø—Ä–æ—î–∫—Ç—ñ GenImg. –í–æ–Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –≤–∏—Å–æ–∫–æ—è–∫—ñ—Å–Ω–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç—ñ–≤ –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è LoRA –º–æ–¥–µ–ª–µ–π.

## üöÄ –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- **üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** - –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
- **üîç –ê–Ω–∞–ª—ñ–∑ —è–∫–æ—Å—Ç—ñ –∑–æ–±—Ä–∞–∂–µ–Ω—å** - –æ—Ü—ñ–Ω–∫–∞ –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
- **üè∑Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ç–µ–≥—É–≤–∞–Ω–Ω—è** - —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –ø–æ–∑, –æ–¥—è–≥—É, —Å—Ç–∏–ª—ñ–≤
- **üìä –ê–Ω–∞–ª—ñ–∑ –¥–∞—Ç–∞—Å–µ—Ç—É** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
- **üßπ –û—á–∏—â–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤** - –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
- **üì¶ –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö** - JSON —Ç–∞ CSV —Ñ–æ—Ä–º–∞—Ç–∏
- **üíæ Backup —Å–∏—Å—Ç–µ–º–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
GenImg/
‚îú‚îÄ‚îÄ mcp/                          # JSON –º–µ—Ç–∞–¥–∞–Ω—ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ image_a1b2c3d4.json     # –ú–µ—Ç–∞–¥–∞–Ω—ñ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
‚îÇ   ‚îî‚îÄ‚îÄ image_e5f6g7h8.json     # ...
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ mcp_config.yaml          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è MCP —Å–∏—Å—Ç–µ–º–∏
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ mcp_json_saver.py        # –û—Å–Ω–æ–≤–Ω–∏–π –∫–ª–∞—Å –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ mcp_manager.py           # CLI —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
‚îî‚îÄ‚îÄ prompts/
    ‚îî‚îÄ‚îÄ prompts.txt              # –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
```

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

–û—Å–Ω–æ–≤–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ `config/mcp_config.yaml`:

```yaml
# –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
directories:
  mcp_output: "mcp"              # –ü–∞–ø–∫–∞ –¥–ª—è JSON —Ñ–∞–π–ª—ñ–≤
  image_output: "data/output"    # –ü–∞–ø–∫–∞ –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å

# –û—Ü—ñ–Ω–∫–∞ —è–∫–æ—Å—Ç—ñ
quality_assessment:
  enabled: true
  identity_score_weight: 0.4     # –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ (40%)
  resolution_score_weight: 0.3   # –†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å (30%)
  file_size_score_weight: 0.2    # –†–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É (20%)
  format_score_weight: 0.1       # –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É (10%)

# –ö—Ä–∏—Ç–µ—Ä—ñ—ó –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
training_suitability:
  min_quality_score: 0.7         # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —è–∫—ñ—Å—Ç—å
  min_identity_score: 0.8        # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—Ö–æ–∂—ñ—Å—Ç—å
```

### 2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ

```python
from scripts.mcp_json_saver import MCPMetadataManager

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
manager = MCPMetadataManager()

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö
metadata = manager.generate_mcp_entry(
    source_image="data/input/character_reference.jpg",
    generated_image_path="data/output/character_001.png",
    prompt_text="portrait of beautiful woman, elegant dress",
    negative_prompt="blurry, low quality",
    identity_similarity_score=0.92,
    generation_cost=0.075,
    generation_time=45.2
)

# –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è
manager.save_mcp_json(metadata)
```

## üõ†Ô∏è CLI –ö–æ–º–∞–Ω–¥–∏

### –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

```bash
# –ê–Ω–∞–ª—ñ–∑ –¥–∞—Ç–∞—Å–µ—Ç—É
python scripts/mcp_manager.py analyze

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∞–ª—ñ–¥–Ω–æ—Å—Ç—ñ
python scripts/mcp_manager.py validate

# –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
python scripts/mcp_manager.py summary

# –ï–∫—Å–ø–æ—Ä—Ç –≤ JSON
python scripts/mcp_manager.py export dataset.json --format json

# –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV
python scripts/mcp_manager.py export dataset.csv --format csv

# –û—á–∏—â–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
python scripts/mcp_manager.py cleanup

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è backup
python scripts/mcp_manager.py backup
```

### –î–µ—Ç–∞–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

```bash
# –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏
python scripts/mcp_manager.py analyze --detailed

# –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
python scripts/mcp_manager.py summary --detailed

# –ï–∫—Å–ø–æ—Ä—Ç –∑ –∫–∞—Å—Ç–æ–º–Ω–æ—é –Ω–∞–∑–≤–æ—é
python scripts/mcp_manager.py export "exports/my_dataset_$(date +%Y%m%d).json"
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö

–ö–æ–∂–µ–Ω JSON —Ñ–∞–π–ª –º—ñ—Å—Ç–∏—Ç—å:

```json
{
  "image_id": "uuid-—Å—Ç—Ä–æ–∫–∞",
  "timestamp": "2024-01-07T14:30:00",
  "project_name": "GenImg_Dataset",
  
  "source_image": "data/input/character_reference.jpg",
  "generated_image": "data/output/character_001.png",
  "image_hash": "md5-—Ö–µ—à-—Ñ–∞–π–ª—É",
  
  "generation_params": {
    "prompt_text": "portrait of beautiful woman...",
    "negative_prompt": "blurry, low quality...",
    "denoising_strength": 0.4,
    "cfg_scale": 7.5,
    "steps": 30
  },
  
  "lora_training": {
    "suitable_for_training": true,
    "quality_score": 0.85,
    "training_tags": ["front_view", "portrait", "photorealistic"],
    "pose_category": "standing",
    "outfit_category": "dress"
  },
  
  "status": {
    "generation_status": "success",
    "generation_cost": 0.075,
    "generation_time_seconds": 45.2
  }
}
```

## üìà –ê–Ω–∞–ª—ñ–∑ —è–∫–æ—Å—Ç—ñ

### –ö—Ä–∏—Ç–µ—Ä—ñ—ó –æ—Ü—ñ–Ω–∫–∏

1. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ (40%)** - –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ö–æ–∂–µ –Ω–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª
2. **–†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å (30%)** - —è–∫—ñ—Å—Ç—å —Ç–∞ —Ä–æ–∑–º—ñ—Ä –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è  
3. **–†–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É (20%)** - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä (0.5-5MB)
4. **–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É (10%)** - –ø–µ—Ä–µ–≤–∞–≥–∞ PNG —Ñ–æ—Ä–º–∞—Ç—É

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ç–µ–≥—É–≤–∞–Ω–Ω—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î:

- **–ü–æ–∑–∏**: `standing`, `sitting`, `lying`, `walking`, `dancing`
- **–û–¥—è–≥**: `dress`, `suit`, `swimwear`, `lingerie`, `casual`
- **–ö—É—Ç–∏**: `front_view`, `side_view`, `back_view`
- **–°—Ç–∏–ª—ñ**: `photorealistic`, `anime_style`, `artistic`

## üîç –ê–Ω–∞–ª—ñ–∑ –¥–∞—Ç–∞—Å–µ—Ç—É

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É

```
üìä MCP DATASET SUMMARY
=======================================
üìÅ Total images: 15
‚úÖ Successful: 14
‚ùå Failed: 1
üéØ Training suitable: 12
‚≠ê Average quality: 0.82

üìê Pose distribution:
  standing: 8
  sitting: 4
  lying: 2

üëó Outfit distribution:
  dress: 6
  suit: 3
  casual: 4

üí° Recommendations:
  ‚Ä¢ Add more walking poses
  ‚Ä¢ Consider generating swimwear variations
  ‚Ä¢ Improve lighting consistency
```

## üö® –ù–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

1. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** - –∑–∞–≤–∂–¥–∏ –∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ –ø—ñ—Å–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
2. **–†–µ–≥—É–ª—è—Ä–Ω–∏–π –∞–Ω–∞–ª—ñ–∑** - –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ —è–∫—ñ—Å—Ç—å –¥–∞—Ç–∞—Å–µ—Ç—É
3. **Backup –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** - —Ä–æ–±—ñ—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó
4. **–û—á–∏—â–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤–∏–¥–∞–ª—è–π—Ç–µ –¥—É–±–ª—ñ–∫–∞—Ç–∏
5. **–ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ** - –ø—ñ–¥—Ç—Ä–∏–º—É–π—Ç–µ –º—ñ–Ω—ñ–º—É–º 0.7 —è–∫–æ—Å—Ç—ñ

### ‚ùå –ß–æ–≥–æ —É–Ω–∏–∫–∞—Ç–∏

1. –ù–µ –≤–∏–¥–∞–ª—è–π—Ç–µ JSON —Ñ–∞–π–ª–∏ –±–µ–∑ backup
2. –ù–µ –∑–º—ñ–Ω—é–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –≤—Ä—É—á–Ω—É
3. –ù–µ —ñ–≥–Ω–æ—Ä—É–π—Ç–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
4. –ù–µ –Ω–∞–∫–æ–ø–∏—á—É–π—Ç–µ –¥—É–±–ª—ñ–∫–∞—Ç–∏

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

```python
# –í ReplicateGenerator
from scripts.mcp_json_saver import MCPMetadataManager

class ReplicateGenerator:
    def __init__(self):
        self.mcp_manager = MCPMetadataManager()
    
    def generate_with_metadata(self, ...):
        # –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        image_path = self.generate_image(...)
        
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö
        metadata = self.mcp_manager.generate_mcp_entry(
            source_image=reference_path,
            generated_image_path=image_path,
            prompt_text=prompt,
            # ... —ñ–Ω—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
        )
        self.mcp_manager.save_mcp_json(metadata)
```

## üì¶ –ï–∫—Å–ø–æ—Ä—Ç –¥–ª—è LoRA —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è

### JSON —Ñ–æ—Ä–º–∞—Ç (–ø–æ–≤–Ω–∏–π)

```bash
python scripts/mcp_manager.py export lora_dataset.json
```

–°—Ç–≤–æ—Ä—é—î –ø–æ–≤–Ω–∏–π –¥–∞—Ç–∞—Å–µ—Ç –∑ —É—Å—ñ–º–∞ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É.

### CSV —Ñ–æ—Ä–º–∞—Ç (—Å–ø—Ä–æ—â–µ–Ω–∏–π)

```bash
python scripts/mcp_manager.py export lora_dataset.csv --format csv
```

–°—Ç–≤–æ—Ä—é—î —Å–ø—Ä–æ—â–µ–Ω—É —Ç–∞–±–ª–∏—Ü—é –∑ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É.

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

1. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é**:
   ```bash
   cp config/mcp_config.yaml.example config/mcp_config.yaml
   ```

2. **–ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏**:
   ```bash
   python scripts/replicate_generate.py --count 15
   ```

3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏**:
   ```bash
   python scripts/mcp_manager.py summary
   ```

4. **–ï–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ –¥–∞—Ç–∞—Å–µ—Ç**:
   ```bash
   python scripts/mcp_manager.py export my_lora_dataset.json
   ```

## ü§ù –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–ü—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø—Ä–æ–±–ª–µ–º:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `logs/mcp_metadata.log`
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –≤–∞–ª—ñ–¥–∞—Ü—ñ—é: `python scripts/mcp_manager.py validate`
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤ `config/mcp_config.yaml`

---

**–ì–æ—Ç–æ–≤–æ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ LoRA —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è!** üéâ 